@page "/mis-beneficios"
@using Web.FrontOffice.Components.Shared
@rendermode InteractiveServer

<Microsoft.AspNetCore.Components.Web.PageTitle>Mis Beneficios</Microsoft.AspNetCore.Components.Web.PageTitle>

<div class="benefits-container">
    <PageHeader Title="Mis Beneficios" Subtitle="Beneficios disponibles y consumidos" />

    <div class="benefits-grid">
        @foreach (var beneficio in beneficios)
        {
            <Card Title="@beneficio.TipoBeneficio.Nombre">
                <div class="benefit-content">
                    <p class="benefit-description">@beneficio.TipoBeneficio.Descripcion</p>

                    <div class="benefit-details">
                        <InfoField Label="Vigencia Desde" Value="@beneficio.Vigencia.Inicio.ToString("dd/MM/yyyy")" />
                        <InfoField Label="Vigencia Hasta" Value="@beneficio.Vigencia.Fin.ToString("dd/MM/yyyy")" />
                        <InfoField Label="Cupos Disponibles" Value="@beneficio.Cupos.ToString()" />
                    </div>

                    @if (beneficio.Consumos.Any())
                    {
                        <div class="consumptions">
                            <h4>Consumos Realizados</h4>
                            @foreach (var consumo in beneficio.Consumos)
                            {
                                <div class="consumption-item">
                                    <span>Cantidad: @consumo.Cantidad</span>
                                    <span>Fecha: @consumo.Uso.Fecha.ToString("dd/MM/yyyy HH:mm")</span>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <p class="no-data">No has utilizado este beneficio aún</p>
                    }
                </div>
            </Card>
        }
    </div>

    <div class="back-action">
        <a href="/perfil" class="action-link">
            <PrimaryButton Text="Volver a Mi Perfil" />
        </a>
    </div>
</div>

@code {
    private List<Beneficio> beneficios = new List<Beneficio>
    {
        new Beneficio
        {
            TipoBeneficio = new TipoBeneficio
            {
                Nombre = "Descuento Gimnasio",
                Descripcion = "20% de descuento en todas las membresías mensuales"
            },
            Vigencia = new DateRange
            {
                Inicio = new DateTime(2025, 1, 1),
                Fin = new DateTime(2025, 12, 31)
            },
            Cupos = 8,
            Consumos = new List<Consumo>
            {
                new Consumo
                {
                    Cantidad = 1,
                    Uso = new Uso { Fecha = new DateTime(2025, 9, 15, 10, 30, 0) }
                },
                new Consumo
                {
                    Cantidad = 1,
                    Uso = new Uso { Fecha = new DateTime(2025, 10, 1, 11, 0, 0) }
                }
            }
        },
        new Beneficio
        {
            TipoBeneficio = new TipoBeneficio
            {
                Nombre = "Estacionamiento Gratuito",
                Descripcion = "Acceso gratuito al estacionamiento durante horarios laborales"
            },
            Vigencia = new DateRange
            {
                Inicio = new DateTime(2025, 1, 1),
                Fin = new DateTime(2025, 12, 31)
            },
            Cupos = 15,
            Consumos = new List<Consumo>()
        },
        new Beneficio
        {
            TipoBeneficio = new TipoBeneficio
            {
                Nombre = "Cafetería VIP",
                Descripcion = "Bebida gratis por día en la cafetería del edificio"
            },
            Vigencia = new DateRange
            {
                Inicio = new DateTime(2025, 10, 1),
                Fin = new DateTime(2025, 10, 31)
            },
            Cupos = 22,
            Consumos = new List<Consumo>
            {
                new Consumo
                {
                    Cantidad = 1,
                    Uso = new Uso { Fecha = new DateTime(2025, 10, 16, 9, 0, 0) }
                }
            }
        }
    };

    public class Beneficio
    {
        public TipoBeneficio TipoBeneficio { get; set; } = new();
        public DateRange Vigencia { get; set; } = new();
        public int Cupos { get; set; }
        public List<Consumo> Consumos { get; set; } = new();
    }

    public class TipoBeneficio
    {
        public string Nombre { get; set; } = string.Empty;
        public string Descripcion { get; set; } = string.Empty;
    }

    public class DateRange
    {
        public DateTime Inicio { get; set; }
        public DateTime Fin { get; set; }
    }

    public class Consumo
    {
        public int Cantidad { get; set; }
        public Uso Uso { get; set; } = new();
    }

    public class Uso
    {
        public DateTime Fecha { get; set; }
    }
}

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Mobile.ViewModels"
             xmlns:converters="clr-namespace:Mobile.Converters"
             x:Class="Mobile.Pages.ProfilePage"
             x:DataType="viewmodels:ProfileViewModel"
             Title="{Binding Title}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:IsNotNullConverter x:Key="IsNotNullConverter"/>
            <converters:BoolToActiveStatusConverter x:Key="BoolToActiveStatusConverter"/>
            <converters:BoolToStatusColorConverter x:Key="BoolToStatusColorConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">
            
            <!-- Offline Indicator -->
            <Frame IsVisible="{Binding IsOfflineMode}"
                   BackgroundColor="#FFF3CD"
                   BorderColor="#FFC107"
                   Padding="15"
                   CornerRadius="8">
                <HorizontalStackLayout Spacing="10">
                    <Label Text="âš ï¸" FontSize="20"/>
                    <Label Text="Modo offline - Mostrando datos guardados"
                           TextColor="#856404"
                           VerticalOptions="Center"/>
                </HorizontalStackLayout>
            </Frame>

            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsLoadingProfile}"
                             IsVisible="{Binding IsLoadingProfile}"
                             Color="{StaticResource Primary}"
                             HeightRequest="50"/>

            <!-- Profile Card -->
            <Frame IsVisible="{Binding Profile, Converter={StaticResource IsNotNullConverter}}"
                   BackgroundColor="White"
                   BorderColor="#E0E0E0"
                   Padding="20"
                   CornerRadius="12"
                   HasShadow="True">
                
                <VerticalStackLayout Spacing="15">
                    
                    <!-- Avatar Icon -->
                    <Frame BackgroundColor="{StaticResource Primary}"
                           WidthRequest="80"
                           HeightRequest="80"
                           CornerRadius="40"
                           HorizontalOptions="Center"
                           Padding="0">
                        <Label Text="ðŸ‘¤"
                               FontSize="40"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"/>
                    </Frame>

                    <!-- Full Name -->
                    <Label Text="{Binding Profile.FullName}"
                           FontSize="24"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           TextColor="{StaticResource Primary}"/>

                    <!-- Email -->
                    <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                        <Label Text="ðŸ“§" FontSize="18"/>
                        <Label Text="{Binding Profile.Email}"
                               FontSize="16"
                               TextColor="{StaticResource Gray600}"/>
                    </HorizontalStackLayout>

                    <BoxView HeightRequest="1"
                             Color="#E0E0E0"
                             Margin="0,10"/>

                    <!-- User ID -->
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="ID de Usuario:"
                               FontAttributes="Bold"
                               WidthRequest="120"/>
                        <Label Text="{Binding Profile.Id}"/>
                    </HorizontalStackLayout>

                    <!-- Birth Date -->
                    <HorizontalStackLayout Spacing="10"
                                         IsVisible="{Binding Profile.BirthDate, Converter={StaticResource IsNotNullConverter}}">
                        <Label Text="Fecha de Nac.:"
                               FontAttributes="Bold"
                               WidthRequest="120"/>
                        <Label Text="{Binding Profile.BirthDate, StringFormat='{0:dd/MM/yyyy}'}"/>
                    </HorizontalStackLayout>

                    <!-- Status -->
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Estado:"
                               FontAttributes="Bold"
                               WidthRequest="120"/>
                        <Label Text="{Binding Profile.IsActive, Converter={StaticResource BoolToActiveStatusConverter}}"
                               TextColor="{Binding Profile.IsActive, Converter={StaticResource BoolToStatusColorConverter}}"/>
                    </HorizontalStackLayout>

                    <!-- Created At -->
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Creado:"
                               FontAttributes="Bold"
                               WidthRequest="120"/>
                        <Label Text="{Binding Profile.CreatedAt, StringFormat='{0:dd/MM/yyyy HH:mm}'}"/>
                    </HorizontalStackLayout>

                </VerticalStackLayout>
            </Frame>

            <!-- Actions -->
            <VerticalStackLayout Spacing="15">
                
                <!-- Refresh Button -->
                <Button Text="ðŸ”„ Actualizar Datos"
                        Command="{Binding LoadProfileCommand}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        CornerRadius="8"
                        HeightRequest="50"/>

                <!-- Logout Button -->
                <Button Text="ðŸšª Cerrar SesiÃ³n"
                        Command="{Binding LogoutCommand}"
                        BackgroundColor="#DC3545"
                        TextColor="White"
                        CornerRadius="8"
                        HeightRequest="50"/>

            </VerticalStackLayout>

        </VerticalStackLayout>
    </ScrollView>
    
</ContentPage>
